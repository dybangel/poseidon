<html lang="zh" class="pixel-ratio-2 retina ios ios-9 ios-9-1 ios-gt-8 ios-gt-7 ios-gt-6 watch-active-state" style="font-size: 32px;">
	<head _wxhkphogpkobbkjccgfifhfjlahnoocnan_="shake_1.0">
		<title></title>
		<meta charset="UTF-8">
		<meta name="viewport" content="width=device-width, initial-scale=1.0, minimum-scale=1.0, maximum-scale=1.0, user-scalable=no">
		<link rel="apple-touch-icon" href="images/logo.png">
		<link rel="apple-touch-icon-precomposed" href="images/logo.png">
		<link href="/favicon.ico" type="image/x-icon" rel="shortcut icon">
		<!--	<link rel="stylesheet" type="text/css" href="css/iconfont.css">-->
		<link rel="stylesheet" type="text/css" href="css/iconfont.css">
		<link rel="stylesheet" type="text/css" href="css/framework7-a286981f62.ios_min.css">
		<!--<link rel="stylesheet" type="text/css" href="http://img.pphongbao.com/public/app/css/framework7/framework7-a286981f62.ios_min.css">-->
		<link rel="stylesheet" type="text/css" href="css/index_min.css">
		<link rel="stylesheet" type="text/css" href="css/mystyle.css">

		<style>
			@font-face {
				font-family: uc-nexus-iconfont;
				src: url(chrome-extension://pogijhnlcfmcppgimcaccdkmbedjkmhi/res/font_9qmmi8b8jsxxbt9.woff) format('woff'), url(chrome-extension://pogijhnlcfmcppgimcaccdkmbedjkmhi/res/font_9qmmi8b8jsxxbt9.ttf) format('truetype')
			}

			[v-cloak] {
				display: none;
			}
		</style>
	</head>
	<script>

	</script>
	<body class="global-web framework7-root">
		<div class="statusbar-overlay"></div>
		<!-- Views -->
		<div class="views" id="taskdetail" v-cloak>
			<!-- Your main view, should have "view-main" class -->
			<div class="view view-main" data-page="index">
				<div class="navbar">
					<div class="navbar-inner pp-tab fasttask navbar-on-center">
						<div class="left1 sliding event_close">
							<a href="#" class="back link icon-only">
								<i class="icon icon-back" style=""></i>
							</a>
						</div>
						<div class="center1 sliding" style="margin-right: 39%;">任务详情</div>
						<!--<div class="right sliding" style="transform: translate3d(0px, 0px, 0px);">
              <a href="/index.php/fasttask/fastRecords" class="link icon-only">截图审核</a></div>-->
					</div>
				</div>
				<div class="pages">
					<!-- Page, data-page contains page name-->
					<div class="page" data-page="fastdetail">
						<div class="fasttask-wifi">
							<div class="mask" onClick="hidePop('.fasttask-wifi')"></div>
							<div class="content">
								<div class="fasttask-wifi-close">
									<div class="icon" onClick="hidePop('.fasttask-wifi')">×</div>
									<div class="line"></div>
								</div>
								<img src="http://img.pphongbao.com/public/app/img/fasttask/ding.png">
								<p>恭喜！领取奖励成功</p>
								<div class="btn event_close">我知道了</div>
							</div>
						</div>
						<div class="fasttask-money-pop" style=" background: none repeat scroll 0 0 rgba(0,0,0,.85);">
							<div class="mask"></div>
							<div class="content">
								<p class="p1">恭喜！达成小目标！</p>
								<div class="operation" style="margin-top: 2rem;margin-left: 1.5rem;">
									<!--<div class="go-invite">分享赚钱</div>-->
									<div class="go-back event_close">继续赚钱</div>
								</div>
							</div>
						</div>
						<div class="download-cutdown">
							<div class="mask"></div>
							<div class="content">
								<div class="download-cutdown-close" onclick="hidePop('.download-cutdown')">
									<div class="icon">×</div>
									<div class="line"></div>
								</div>
								<img src="http://img.pphongbao.com/public//app/img/fasttask/logo.png">
								<p>正在打开，请稍等（<span class="download-cutdown-time"></span>s）</p>
							</div>
						</div>
						<div class="page-content fastdetail page-fast-detail" data-wifiType="0">
							<!-- <div class="desc">
								<div class="partin-info pp-flex">
									<div class="money">
										<span class="add">+</span>
										<span class="ff-ppnum">{{coin}}&nbsp</span>
										<span class="unit">金币</span>
									</div>
									<div class="time">
										剩余时间：<span class="countdown" data-interval="1000" data-expireTime="1554714833000"><i class="i"></i><i id="DaoInterval"
											 class="s">30秒</i></span>
									</div>
								</div>
							</div> -->
							<div class="split"></div>
							<div class="container">
								<div class="container-title pp-flex pp-flex-left">
									<i class="icon"></i>
									<h3>任务步骤</h3>
								</div>
								<div id="Stored_FindApplication_container" class="container-list">
									<div class="step-title">
										<img src="images/coin.png">
										<div class="text">完成下列2步 获得奖励</div>
									</div>
									<div>
										<div class="step-item">
											<div class="dot">
												<span></span>
											</div>
											<div class="item-content">
												<div class="step-num">
													<div class="line"></div>
													<p>第一步</p>
												</div>
												<div class="search">
													<img :src="img">
													<div>
														<p class="detail">安装<span>{{name}}</span></p>
													</div>
												</div>
												<div class="copy event_download" @click="download">下载安装 </div>
												<!--<div class="copy event_download" strInstall="{{=it[i].strInstall}}" copy_word="">下载安装 </div> -->
											</div>
										</div>
										<div class="step-item">
											<div class="dot">
												<span></span>
											</div>
											<div class="item-content">
												<div class="step-num">
													<div class="line"></div>
													<p>第二步</p>
												</div>
												<p class="operation">打开App（试玩类任务需试玩满一分钟），如已完成安装，完成第二步即可【必须允许网络接入，否则奖励不到账】，然后点击【领取奖励】，完成任务。</p>
												<div class="disabled down event_open" @click="open">打开App</div>
												<!-- <div AppKey="{{=it[i].AppKey}}" Packername="{{=it[i].Packername}}" class="disabled down open-app event_open">打开App</div> -->
											</div>
										</div>
										<div class="operation-btn">
											<div id="submit-button" class="disabled confirm enable event_finish" @click="finish">领取奖励</div>
											<div @click="giveup_task" class="giveup">放弃任务</div>
										</div>
									</div>
								</div>
							</div>
						</div>
					</div>
				</div>
			</div>
		</div>
		<!--下载进度条相关js mui的-->

		<script src="js/mui.min.js"></script>
		<script src="js/jquery.min.js"></script>
		<script src="js/myfun.js"></script>
		<script src="js/vue.min.js"></script>
		<script src="js/normal.js"></script>
		<script>
			var app = new Vue({
				el: '#taskdetail',
				data: {
					coin: '',
					name: '',
					iurl: '',
					img: '',
					userId: '',
					taskId: '',
					packname: '',
					taskType: '',
					viewId: ''
				},
				mounted() {
					var that = this;
					mui.ready(function() {
						mui.plusReady(function() {
							that.plusReady();
						})
					})
				},
				methods: {
					plusReady() {
						let pars = plus.webview.currentWebview().pars;
						let data = pars.taskdata;
						this.userId = pars.userId;
						this.taskId = data.taskId;
						this.iurl = data.downloadUrl;
						this.packname = data.packageName;
						this.coin = data.coin;
						this.name = data.taskName;
						this.img = data.img;
						this.taskType = data.taskType;
						this.viewId = pars.viewId;
						let app_exist = checkapp(this.packname);
						if (app_exist == 1) {
							$('.event_open').removeClass("disabled");
						}
						Glistview = plus.webview.getWebviewById(this.viewId)
						mui.init({
							swipeBack: true,
							beforeback: function() {
								mui.fire(Glistview, 'Listener', {
									action: "refresh"
								});
								return true;
							}
						});
						mui("body").on("tap", ".event_close", function() {
							mui.fire(Glistview, 'Listener', {
								action: "refresh"
							});
							closeme();
						});
					},
					giveup_task() {
						let param = {
							'userId': this.userId
						}
						get_json('POST', 'task/remove_task', true, param).then(function(res) {
							if (res.code == 0) {
								mui.fire(Glistview, 'Listener', {
									action: "refresh"
								});
								closeme();
							} else {
								check_res(res.code, res.message);
							}
						});
					},
					download() {
						let app_exist = checkapp(this.packname);
						if (app_exist == 1) {
							plus.nativeUI.toast('已存在app，请直接打开');
						} else {
							downloadWgt(this.iurl, "downloadcb()");
							$('.event_open').removeClass("disabled");
							// getjson("Stored_FindAppDown", "@UserID=N'" + UserID + "',@strToken=N'" + HAppKey + "'");
						}
					},
					open() {
						// var schema = "snssdk1128://detail?id=6674528242147413251&gd_label=click_schema_xjys3";
						// var schema = "";
						// var install_state = checkapp(this.packname);
						// if (0 == install_state) {
						// 	alert('请完成下载安装');
						// } else {
						// 	this.hx_app(this.packname,schema);
						// 	console.log(this.packname);
						// 	if(this.incomeType == 0){
						// 		$('.event_finish').removeClass("disabled");
						// 	}else{
						// 		DaoInterval();
						// 	}
						// }
						openapp(this.packname,this.taskType);

					},
					hx_app(packname, schema) {
						// if("1"==have){
						// mui.toast("正在为您打开 ");
						plus.runtime.openURL(schema, packname);
						// }else{ 
						// 	mui.toast("您还没有安装\""+zhname+"\" 正在为您自动下载");
						// 	downloadWgt(durl,"downloadcb()");	
						// }
					},
					finish() {
						let before_param = {
							'userId': this.userId,
							'taskId': this.taskId
						};
						let str_par = JSON.stringify(before_param);
						let PUBLIC_KEY =
							'MIGfMA0GCSqGSIb3DQEBAQUAA4GNADCBiQKBgQCoQPlryO2uLZcfcu7NVD3onxqWzRgSCDBgUvYRsilgMme7QdSo7E81NrjSzJWVhjJpB+484uzOjANzhczhBRBfLkhqXnq1bFxzSP0xY01K/7QX5oX8Y4+RdwbnaZeJ4y2E5LPit70m0fMNUxB3d6upVaarXTCO0YoQovwte0O1ywIDAQAB';
						let PRIVATE_KEY =
							'MIICdwIBADANBgkqhkiG9w0BAQEFAASCAmEwggJdAgEAAoGBAKhA+WvI7a4tlx9y7s1UPeifGpbNGBIIMGBS9hGyKWAyZ7tB1KjsTzU2uNLMlZWGMmkH7jzi7M6MA3OFzOEFEF8uSGpeerVsXHNI/TFjTUr/tBfmhfxjj5F3Budpl4njLYTks+K3vSbR8w1TEHd3q6lVpqtdMI7RihCi/C17Q7XLAgMBAAECgYEAp2Dbv6oHKHsaF6MShRkE7WE55kLpaybSWUCuojQGjTgXkWWP1Owgb+OcQbhcJn91rp7BFbj5sw/+bvHwOvn6qdbducUn03r1f3t/UOEoYpgc4nwHtLx3/hnn1lKreBvd3BD+3xMnYCHkaIYz0GGwHzjvzQS5D3lhENZb1lxNOGECQQDhcTIsAWc+zhLi77qRWC6NFKm/wLiL1adNWUGgkSjL5CcsN7vxWrf4AzgNTtHwuQFEje/kZ4M68WPxwpSxyhqXAkEAvw9aHKK0hrPLp4GYrnSyJPDHmKZR+lMjF2Nq+GeDUWiXQgvpoykzjepTitkSDZT2uIAKuYTw8MPj3xXUkLqo7QJBAIm0+1CmCsryVdcJWI0vsD+9P3NB5XiFKYy12MCb6q+gzczUvpjPMVDtpm96lgLU/1FA4ihCkoaOrN4gXXO8YEECQFcbMbMyfumW2TeiPzDyZTGwUN+InIFrG+mS2vcrglRAQg3LjpZjt2xxM+tusetdSeqt/bW9JXgvZxmTQ1lEsLUCQHsvqWyDGWA5YHVe7UGmuUwnjc27idxb+RXHXIFJsIIqkBW4+1J2GKjRqlKzAKXp11AjEE8DrognIu36P0otJm8=';
						let encrypt = new JSEncrypt();
						encrypt.setPublicKey('-----BEGIN PUBLIC KEY-----' + PUBLIC_KEY + '-----END PUBLIC KEY-----');
						let encrypted = encrypt.encrypt(str_par);
						let param = {
							'param': encrypted
						};
						// console.log('加密后数据:%o'+encrypted);

						get_json('POST', 'task/task_success', true, param).then(function(res) {
							if (res.code == 0) {
								$('.fasttask-money-pop').css("display", "block");
								$('.fasttask-money-text')[0].innerHTML = 300;
								// mui.fire(Glistview, 'Listener', {
								// 	action: "refresh"
								// });
								// closeme();
							} else {
								check_res(res.code, res.message);
							}
						});

						// getjson("Stored_SaveFinishDown", par);
					}
				}
			})

			function downloadcb() {
				$('.event_open').removeClass("disabled");
			}

			function Stored_FindAppDown(data) {
				//	alert("data[0]['status'] is"+data[0]['status']);
				if ("undefined" == typeof(data[0]['status'])) {
					//说明有数据了
					//alert("有令牌了");
				} else {
					////如果令牌不存在
					//alert("没有这个令牌");
					//	  console.log("HAppKey is:"+HAppKey+"GNickname="+GNickname+"AppID is:"+AppID+"AppName is:"+HAppName+"AppKey is:"+HAppKey+" DeviceCode is:"+DeviceCode+" MacChar is:"+MacChar+" HAmount is:"+HAmount);
					var par = "@strToken=N'" + HAppKey + "',@UserID=N'" + UserID + "',@Nickname=N'" + GNickname + "',@AppID=N'" +
						AppID + "',@Appname=N'" + HAppName + "',@AppKey=N'" + HAppKey + "',";
					par += "@AppModel=N'1',@UnionModel=N'无渠道',@DeviceType=N'Android',@DeviceCode=N'" + DeviceCode + "',@MacChar=N'" +
						MacChar + "',@Amount=N'" + HAmount + "',@strIP=N'" + strIP + "',@cityname=N'" + cityname + "',@strInstall=N'1',";
					par += "@strEdition=N'12.1.3',@strNetwork=N'2',@isBreak=N'0'";
					//console.log("par is:"+par);
					getjson("Stored_SaveAppDown", par);
				}
				//	if("NULL"==data[0]['status']){
				//	  // 保存下载状态
				//// exec [Stored_SaveAppDown] 
				//
				//	}else{
				//		
				//		
				//	}
			}

			// function Stored_SaveFinishDown() {
			// 	// console.log("this is stored_savefindsdown callback");
			// 	//http://192.168.0.101:84/api.aspx?action=ticheng&amount=2&userid=30010792&username=dyb
			// 	// var par = "&amount=" + HAmount + "&userid=" + UserID + "&username=" + GNickname + "";
			// 	// console.log(par);
			// 	// getjson("ticheng", par);
			// 	// getjson("jicha", par);
			// 	//显示奖励弹窗

			// }

			// function enableLJ() {
			// 	console.log("this is enableLJ");
			// 	$('.event_finish').removeClass("disabled");
			// }

			// function disabledLJ() {
			// 	$('.event_finish').addClass("disabled");
			// }

			function DaoInterval() {
				var setTime;
				$(document).ready(function() {
					var time = 60;
					setTime = setInterval(function() {
						if (time == 0) {
							clearInterval(setTime);
							// enableLJ();
							$('.event_finish')[0].innerHTML = "领取奖励";
							$('.event_finish').removeClass("disabled");
							return;
						}
						time--;
						//mui.toast(time);
						// $('#DaoInterval')[0].innerHTML = time;
						$('.event_finish')[0].innerHTML = "领取奖励" + "(" + time + ")";
					}, 1000);
				});
			}
		</script>
	</body>
</html>
