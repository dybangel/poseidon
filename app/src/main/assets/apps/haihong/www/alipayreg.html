<!DOCTYPE html>
<html>
	<head>
		<meta charset="utf-8">
		<meta name="viewport" content="initial-scale=1.0, maximum-scale=1.0, user-scalable=no" />
		<link rel="stylesheet" type="text/css" href="css/hui.css" />
		<link rel="stylesheet" type="text/css" href="css/mystyle.css">
		<style type="text/css">
			.event_tijiao {
				margin-top: 15px;
				width: 70%;
				margin-left: 15%;
				display:none;
			}
		</style>
	</head>
	<body>
		<header class="hui-header">
			<div id="hui-back"></div>
			<h1>支付宝绑定</h1>
		</header>
		<div class="hui-wrap">
			<form id="form1" class="hui-form">
				<div class="hui-form-items">
					<div class="hui-form-items-title">支付宝账号</div>
					<input class="hui-input event_AlipayChar" type="number" placeholder="请输入手机号" name="phonenum" />
				</div>
				<!-- 				<div class="hui-form-items">
					<div class="hui-form-items-title">支付宝昵称</div>
					<input class="hui-input event_Alipayname" type="text" placeholder="请输入昵称" name="phonenum" />
				</div> -->
			</form>
			<button type="button" class="hui-button hui-primary event_tijiao">提交</button>
		</div>
		<script src="js/mui.min.js"></script>
		<script src="js/jquery.min.js"></script>
		<script src="js/myfun.js"></script>
		<script>
			mui.ready(function() {
				mui.plusReady(function() {
					plusReady();
				})
			})

			function plusReady() {
				getvalue_plus();
				let param = {
					'machineCode': deviceId
				}
				get_json('POST', 'login/get_user_id', true, param).then(function(res) {
					if (res.code == 0) {
						if (res.result.bindAlipay) {
							let param = {
								'userId': userId
							}
							get_json('POST', 'user/get_user_info', true, param).then(function(res) {
								if (res.code == 0) {
									reset_content(res.result.userInfo.alipayAccount);
								} else {
									check_res(res.code, res.message);
								}
							});
						}else{
							$('.event_tijiao').css("display", "block");
						}
					} else {
						check_res(res.code, res.message);
					}
				});

				mui("body").on("tap", ".event_tijiao", function() {
					var AlipayChar = $('.event_AlipayChar').val();
					if (AlipayChar == "") {
						mui.toast("手机号不能为空");
						return;
					}
					let param = {
						'userId': userId,
						'alipayAccount': AlipayChar
					}
					get_json('POST', 'user/upload_alipay_account', true, param).then(function(res) {
						if (res.code == 0) {
							plus.nativeUI.toast(res.message);
							var par = {
								'type': type,
								'userId': userId,
								'deviceId': deviceId
							}
							openwin_plus("./tixiandetail.html", par);
						} else {
							check_res(res.code, res.message);
						}
					});
				});
				function reset_content(e){
					$('.event_AlipayChar').val(e);
					// $('.event_Alipayname').val(Alipayname);
					// $('.event_tijiao').css('display', 'block');
				}
				mui("body").on("tap", ".event_close", function() {
					closeme();
				});
				mui.init({
					swipeBack: true //启用右滑关闭功能
					// beforeback: function() { //监听物理返回按键的方法
					// 	//	Gmainview = plus.webview.getWebviewById(Gmainviewid);
					// 	//Gmainview.reload();
					// 	//	mui.back();
					// 	mui.fire(Gmainview, 'Listener', {
					// 		action: "refresh"
					// 	});
					// 	//返回true，继续页面关闭逻辑
					// 	return true;
					// }
				});
				
			}
		</script>
	</body>
</html>
